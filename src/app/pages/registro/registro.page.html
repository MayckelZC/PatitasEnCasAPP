<ion-content padding>
  <ion-card>
    <ion-title class="form-title">Crear Cuenta</ion-title>
    <form [formGroup]="cuentaForm" (ngSubmit)="onSubmit()">

      <!-- Nombre Completo -->
      <ion-item lines="none">
        <ion-icon name="person-outline" slot="start"></ion-icon>
        <ion-label position="floating">Nombre Completo</ion-label>
        <ion-input formControlName="nombreCompleto"></ion-input>
      </ion-item>

      <!-- Nombre de Usuario -->
      <ion-item lines="none">
        <ion-icon name="person-outline" slot="start"></ion-icon>
        <ion-label position="floating">Nombre de Usuario</ion-label>
        <ion-input formControlName="nombreUsuario"
          (ionBlur)="checkUsernameAvailability(cuentaForm.get('nombreUsuario')?.value)">
        </ion-input>
        <ion-note *ngIf="cuentaForm.get('nombreUsuario')?.hasError('usernameTaken')" color="danger">
          Este nombre de usuario ya existe.
        </ion-note>
      </ion-item>

      <!-- Correo Electrónico -->
      <ion-item lines="none">
        <ion-icon name="mail-outline" slot="start"></ion-icon>
        <ion-label position="floating">Correo Electrónico</ion-label>
        <ion-input formControlName="correo" type="email"
          (ionBlur)="checkEmailAvailability(cuentaForm.get('correo')?.value)">
        </ion-input>
        <ion-note *ngIf="cuentaForm.get('correo')?.hasError('emailTaken')" color="danger">
          Este correo ya está en uso.
        </ion-note>
      </ion-item>


      <!-- Contraseña -->
      <ion-item lines="none">
        <ion-icon name="lock-closed-outline" slot="start"></ion-icon>
        <ion-label position="floating">Contraseña</ion-label>
        <ion-input formControlName="contraseña" type="password"></ion-input>
      </ion-item>

      <!-- Confirmar Contraseña -->
      <ion-item lines="none">
        <ion-icon name="lock-closed-outline" slot="start"></ion-icon>
        <ion-label position="floating">Confirmar Contraseña</ion-label>
        <ion-input formControlName="confirmarContraseña" type="password"></ion-input>
        <ion-note *ngIf="cuentaForm.hasError('passwordMismatch')" color="danger">
          Las contraseñas no coinciden.
        </ion-note>
      </ion-item>

      <!-- Teléfono -->
      <ion-item lines="none">
        <ion-icon name="call-outline" slot="start"></ion-icon>
        <ion-label position="floating">Teléfono</ion-label>
        <ion-input formControlName="telefono" type="tel"
          (ionBlur)="checkPhoneAvailability(cuentaForm.get('telefono')?.value)">
        </ion-input>
        <ion-note *ngIf="cuentaForm.get('telefono')?.hasError('phoneTaken')" color="danger">
          Este número ya está registrado.
        </ion-note>
      </ion-item>

      <!-- Dirección -->
      <ion-item lines="none">
        <ion-icon name="location-outline" slot="start"></ion-icon>
        <ion-label position="floating">Dirección</ion-label>
        <ion-input formControlName="direccion"></ion-input>
      </ion-item>

      <!-- Seleccionar Imagen de Usuario -->
      <div class="file-upload">
        <ion-icon name="camera-outline"></ion-icon>
        <label for="fileInput">Seleccionar Imagen</label>
        <input type="file" id="fileInput" (change)="onFileSelected($event)" accept="image/*">
      </div>

      <!-- Vista previa de la imagen -->
      <div class="image-preview" *ngIf="imagePreview">
        <img [src]="imagePreview" alt="Vista previa">
      </div>

      <div class="button-group">
        <ion-button expand="full" type="submit" [disabled]="!cuentaForm.valid || !selectedFile"
          class="btn-primary">Crear Cuenta</ion-button>
        <ion-button expand="full" class="btn-clear" (click)="onClear()">Limpiar</ion-button>
      </div>
    </form>

    <!-- Enlace para volver al inicio de sesión -->
    <div class="footer-link">
      <a (click)="goToHome()">Volver al inicio de sesión</a>
    </div>
  </ion-card>
</ion-content>